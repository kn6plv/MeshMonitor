<div class="node">
  <div class="chart-select">
    <select onchange="send('chart.change', { id: '{{id}}', address: event.target.value })">
      {{#each nodes}}
      <option value='{{address}}' {{#if (eq ../selected address)}}selected{{/if}}>{{name}}</option>
      {{/each}}
    </select>
  </div>
  <div class="chart-node">
  <canvas id="{{id}}"></canvas>
  <script>
  (function(){
    const chart = new Chart(document.getElementById('{{id}}'), {
      type: 'scatter',
      data: {
        labels: [],
        datasets: [{
          backgroundColor: 'red',
          borderWidth: 0,
          data: [
            {{#each data}}
            { x:{{x}},y:{{y}} },
            {{/each}}
          ],
          pointBackgroundColor: [
            {{#each color}}
            '{{this}}',
            {{/each}}
          ]
        }]
      },
      options: {
        clip: 20,
        scales: {
          x: {
            type: 'time'
          },
          y: {
            title: {
              display: true,
              text: 'Sequence Nr',
            },
            min: 0,
            max: 65535
          }
        },
        plugins: {
          legend: {
            display: false
          }
        }
      }
    });
    let cursor = {{cursor}};
    onMessage['chart.update.response.{{id}}'] = msg => {
      const ndata = msg.value.data;
      const ncolor = msg.value.color;
      const data = chart.data.datasets[0].data;
      const color = chart.data.datasets[0].pointBackgroundColor;
      for (let i = 0; i < ndata.length; i++) {
        data.shift();
        color.shift();
        data.push(ndata[i]);
        color.push(ncolor[i]);
      }
      chart.update();
      cursor = msg.value.cursor;
    }
    whenVisible('info', {{step}}, () => {
      send('chart.update.request', { id: '{{id}}', cursor });
    });
  })();
  </script>
</div>
